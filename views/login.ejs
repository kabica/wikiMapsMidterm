<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
  <script type="text/javascript" src="/scripts/promiseAPI.js"></script>
  <style>
    /* Set the size of the div element that contains the map */
    .testmap {
      /* margin-top: 100px; */
      height: 100px;
      /* The height is 400 pixels */
      width: 100%;
      /* The width is the width of the web page */
    }
  </style>
</head>

<body>
  <h3>My Google Maps Demo</h3>
  <!--The div element for the map -->
  <button id="create">Create</button>
  <div id="mapCollection">
  </div>
  <script>

    function initMap() {
      let i = 0;

      '<% for (userMap of maps) { %>'
      console.log('lat', '<%= userMap.lat %>')
      console.log('lng', '<%= userMap.lng %>')

        // console.log('LOGIN PAGE: ', i);
        map = new google.maps.Map(
          document.getElementById(`map${i}`), {
            zoom: 10,
            center: {lat:JSON.parse('<%= userMap.lat%>'), lng:JSON.parse('<%= userMap.lng%>')},
            gestureHandling: 'cooperative'
          });

        var marker = new google.maps.Marker({
          position: {lat:JSON.parse('<%= userMap.lat%>'), lng:JSON.parse('<%= userMap.lng%>')},
          map: map
        })

        i++;

      '<% for(userMarker of markers){ %>'
      '<% for(userMarkerData of userMarker){ %>'
      if (JSON.parse('<%= userMarkerData.map_id%>') === JSON.parse('<%= userMap.id%>')) {
        let marker = new google.maps.Marker({
          position: {
            lat: JSON.parse('<%= userMarkerData.lat %>'),
            lng: JSON.parse('<%= userMarkerData.lng %>')
          },
          map: map
        })
      }
      '<%  } %>'
      '<%  } %>'
      '<% } %>'
    }

  </script>
  <script>
    $(document).ready(function () {
      $mapContainer = $("#mapCollection")

      const empty = function () {
        $('#mapCollection').empty();
        for(let i = 0; i < '<%= maps.length %>'; i++) {
          $('#mapCollection').append(`<div id='map${i}' class='testmap'>ALEX</div>`)
        }
        initMap();
      }
      $('#create').on('click', function () {
        empty();
      })
    })
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= key %>&callback=initMap"></script>

</body>
</html>

